<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Fractal Mountain Camera</title>
    <style>
      * {
            margin: 0px;
            padding: 0px;
            border: 0;
            outline: 0;
            font-size: 100%;
            vertical-align: baseline;
            background:transparent;
        }
    </style>
  </head>
  <body>
    <script>
      class FractalMountain extends HTMLElement {
        constructor() {
          super();

          const shadow = this.attachShadow({mode: 'open'});
          const canvas = document.createElement('canvas');
          const ctx = canvas.getContext('2d');

          canvas.width = 1080;
          canvas.height = 768;

          const button = document.createElement('button');
          button.textContent = 'Generate Fractal Mountain';

          function _generateMountain(height,color,amplitude) {
            let starting_height = height
            let start_point = [0, starting_height];
            let end_point = [canvas.width, starting_height];
            let points = [start_point, end_point];

            let iterations = 10;

            function rand(min, max) {
              return Math.floor(Math.random() * (max - min + 1) + min);
            }

            function _genVariantPoint(p1, p2, amount) {
              let x = (p1[0] + p2[0]) / 2;
              let y = (p1[1] + p2[1]) / 2 + rand(-amount, amount);
              return [x, y];
            }

            function _genVariantPointList(point_list, amount) {
              let new_point_list = [point_list[0]];
              for (let i = 0; i < point_list.length - 1; i++) {
                let p1 = point_list[i];
                let p2 = point_list[i + 1];
                new_point_list.push(_genVariantPoint(p1, p2, amount));
                new_point_list.push(p2);
              }
              return new_point_list;
            }

            for (let i = 0; i < iterations; i++) {
              points = _genVariantPointList(points, amplitude / Math.pow(2,i));
            }

            ctx.beginPath();
            ctx.moveTo(points[0][0], points[0][1]);
            for (let i = 1; i < points.length; i++) {
              let x = points[i][0];
              let y = points[i][1];
              ctx.lineTo(x, y);
            }
            ctx.lineTo(canvas.width, canvas.height);
            ctx.lineTo(0, canvas.height);
            ctx.fillStyle = color;
            ctx.fill();
            ctx.stroke();
          }

          button.addEventListener('click', function() {
            let starting_height = canvas.height * 1/3;
            _generateMountain(starting_height+0,'#38004F',50)
            _generateMountain(starting_height+100,'#300048',125);
            _generateMountain(starting_height+200,'#200040',150);
          });
          shadow.appendChild(canvas);
          shadow.appendChild(button);
        }
      }
      customElements.define('fractal-mountain', FractalMountain);
    </script>
    <fractal-mountain></fractal-mountain>
  </body>
</html>

